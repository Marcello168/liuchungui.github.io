<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Mac | liuchungui's Blog]]></title>
  <link href="http://liuchungui.github.io/blog/categories/mac/atom.xml" rel="self"/>
  <link href="http://liuchungui.github.io/"/>
  <updated>2015-10-23T18:36:34+08:00</updated>
  <id>http://liuchungui.github.io/</id>
  <author>
    <name><![CDATA[刘春桂]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[CocoaPods创建私有Pods]]></title>
    <link href="http://liuchungui.github.io/blog/2015/10/19/cocoapodschuang-jian-si-you-pods/"/>
    <updated>2015-10-19T21:54:54+08:00</updated>
    <id>http://liuchungui.github.io/blog/2015/10/19/cocoapodschuang-jian-si-you-pods</id>
    <content type="html"><![CDATA[<p>创建Pod私有源步骤：  <br/>
1、创建一个git仓库，用来存放Podspec  <br/>
2、添加私有的repo到CocoaPods  <br/>
3、制作Podspec，并且推送到你创建的私有repo   <br/>
4、使用Pod，在Podfile添加私有源来搭建项目</p>

<!-- more -->


<p></p>

<p>下面，跟着我一步一步来制作Pod私有源，并且使用私有源当中框架来搭建项目。</p>

<h3>1、创建一个git仓库，用来存放Podspec</h3>

<p>这里我直接是使用github仓库<a href="https://github.com/liuchungui/first.git">https://github.com/liuchungui/first.git</a>    <br/>
当然如果是公司需要建立组件库，放在公司的git服务器上，这样就不会公开了。如果公司没有git服务器，不急，搭建git服务器很简单，可以参照我的<a href="http://www.liuchungui.com/blog/2015/10/23/gitzong-jie/">Git简单总结</a>来搭建。</p>

<h3>2、添加私有的repo到CocoaPods</h3>

<p>主要命令是<code>pod repo add REPO_NAME SOURCE_URL</code>。其中，REPO_NAME是私有repo的名字，随便你取，以后公司内部的组件对应的podspec都可以推送到这个repo中；SOURCE_URL是你git仓库的链接。</p>

<pre><code>$ pod repo add liuchungui https://github.com/liuchungui/first.git
$ ls ~/.cocoapods/repos  
liuchungui  master
</code></pre>

<p>这时，你会发现有两个文件夹<code>liuchungui</code>和<code>master</code>，master是Cocoapods官方的repo，而liuchungui就是我刚刚创建的。进入liuchungui文件夹查看，你会发现它是clone了一份<code>https://github.com/liuchungui/first.git</code>。</p>

<h3>3、制作Podspec，并且推送到你创建的私有repo</h3>

<p>CocoaPods本身就是用来管理公共库和解决它们之间依赖的一套解决方案，这里我就以我写的一个框架<a href="https://github.com/liuchungui/BGNetwork">BGNetwork</a>的Podspec制作为例。    <br/>
1、在github上创建一个空的仓库，克隆到本地   <br/>
<code>git clone https://github.com/liuchungui/BGNetwork</code>   <br/>
2、在本地使用创建项目，然后写框架，框架写完了之后，提交到github，并打上版本号。</p>

<pre><code>git add .
git commit -m 'add file'
git push origin master
git tag -m 'add tag' '0.1.2'
git push --tags
</code></pre>

<p>3、我们开始制作Podspec文件。  <br/>
BGNetwork是一个基于AFNetworking的网络框架，它主要的源文件都在BGNetwork/BGNetwork路径下。我们将它放在CocoaPods给第三方使用，主要是将这个文件夹下的源文件加载到第三方的项目中以供使用，那么Podspec可以这样写。</p>

<pre><code>Pod::Spec.new do |spec|
  #项目名称
  spec.name         = 'BGNetwork'
  #版本号
  spec.version      = '0.1.1'
  #开源协议
  spec.license      = 'MIT'
  #对开源项目的描述
  spec.summary      = 'BGNetwork is a request util based on AFNetworking'
  #开源项目的首页，这个如果没有，可以随便写
  spec.homepage     = 'https://github.com/chunguiLiu/BGNetwork'
  #作者信息
  spec.author       = {'chunguiLiu' =&gt; 'chunguiLiu@126.com'}
  #项目的源和版本号，这个不能乱写
  spec.source       = { :git =&gt; 'https://github.com/chunguiLiu/BGNetwork.git', :tag =&gt; '0.1.1' }
  #源文件，这个就是供第三方使用的源文件
  spec.source_files = "BGNetwork/*"
  #适用于ios7及以上版本
  spec.platform     = :ios, '7.0'
  #使用的是ARC
  spec.requires_arc = true
  #依赖AFNetworking2.0
  spec.dependency 'AFNetworking', '~&gt; 2.0'
end
</code></pre>

<p>4、验证并推送到服务器    <br/>
在推送前，我们先验证Podspec，验证的时候是验证BGNetwork.podspec文件，所以我们需要保证进入的目录和BGNetwork.podspec同级的    <br/>
<code>$ pod lib lint</code>   <br/>
注意：验证的时候，会获取BGNetwork.podspec文件中的spec.source来获取git服务器上面对应版本的代码，然后再找到spec.source_files中的源代码，通过xcode命令行工具建立工程并且进行编译。所以这一步的过程会比较久，如果没有编译没有错误，就验证通过。</p>

<p>如果没有错误和警告我们就可以推送到服务器了，推送使用的命令是<code>pod repo push REPO_NAME SPEC_NAME.podspec</code>，它也会先验证，然后再推送。         <br/>
<code>$ pod repo push liuchungui BGNetwork.podspec</code> <br/>
如果没有错误，但是有警告，我们就将警告解决，也可以加<code>--allow-warnings</code>来提交   <br/>
<code>$ pod repo push liuchungui BGNetwork.podspec --allow-warnings</code>   <br/>
如果有错误，我们可以去查看错误信息对应下的Note信息。</p>

<p>5、搜索我们的框架
到这一步，我们就可以通过<code>pod search BGNetwork</code>来搜索了，搜索到了说明我们私有源建立成功。</p>

<pre><code>$ pod search BGNetwork
-&gt; BGNetwork (0.1.2)
   BGNetwork is a request util based on AFNetworking
   pod 'BGNetwork', '~&gt; 0.1.2'
   Homepage: https://github.com/chunguiLiu/BGNetwork
   Source:   https://github.com/chunguiLiu/BGNetwork.git
   Versions: 0.1.1, 0.1.0 [liuchungui repo] - 0.1.2, 0.1.1 [master repo]
</code></pre>

<p>由上面的搜索知道，BGNetwork在liuchungui和master两个repo中都存在。</p>

<h3>4、使用Pod，在Podfile添加私有源来搭建项目</h3>

<p>使用时，在Podfile文件中添加<strong>本地私有源和官方源</strong>。如果没有添加本地私有源，它默认是用官方的repo，这样找不到本地的Pod；如果只是设置了本地私有源，就不会再去官方源中查找。
 下面是Podfile内容</p>

<pre><code class="```">   #官方Cocoapods的源
   source 'https://github.com/CocoaPods/Specs.git'
   #本地私有源
   source 'https://github.com/liuchungui/first.git'
   platform :ios, '7.0'
   pod 'BGNetwork', '~&gt; 0.1.1'
</code></pre>

<h4>注意</h4>

<p>1、途中遇到了几次问题，就是pod repo push不上去，显示没有找到对应文件，后来发现是版本的问题，没有打上版本号或者Podspec中版本错了。所以我们在维护一个框架时，修改框架之后，push到git服务器之后先打上tag，然后再修改podspec文件中的版本，最后push到对应的pod repo中。</p>

<p>2、若是在框架当中，存在不同的文件夹，请使用<code>subspec</code>。如果不同文件夹之间的文件有相互导入的情况，请将被导入的头文件设置为<code>public_header_files</code>，并且通过<code>dependency</code>设置依赖，具体可以参考<a href="https://github.com/AFNetworking/AFNetworking/blob/master/AFNetworking.podspec">AFNetworking的podspec</a>文件。</p>

<p>3、若是需要提交给官方，请使用</p>

<pre><code>pod trunk register youremail
查看信息
pod trunk me
将对应的pod推送到服务器
pod turnk push
</code></pre>

<p>4、使用<code>pod install</code>时，它首先会更新整个官方的源，而Cocoapods每天都有很多人提交，所以更新比较慢。所以，建议每过一段时间更新一下官方库，平常的时候，咱们可以在install或update加一个参数不用它更新。</p>

<pre><code>$ pod install --verbose --no-repo-update
$ pod update --verbose --no-repo-update
</code></pre>

<h4>参考</h4>

<p><a href="https://guides.cocoapods.org/making/private-cocoapods.html">Private Pods</a>   <br/>
<a href="http://blog.wtlucky.com/blog/2015/02/26/create-private-podspec/">使用Cocoapods创建私有podspec</a>   <br/>
<a href="http://blog.csdn.net/wzzvictory/article/details/18737437?utm_source=tuicool">CocoaPods详解之&mdash;-使用篇</a></p>
]]></content>
  </entry>
  
</feed>
