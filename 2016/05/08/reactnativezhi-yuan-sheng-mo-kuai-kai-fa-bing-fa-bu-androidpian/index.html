<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>ReactNative之原生模块开发并发布——android篇 | 刘春桂的博客</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">ReactNative之原生模块开发并发布——android篇</h1><a id="logo" href="/.">刘春桂的博客</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">ReactNative之原生模块开发并发布——android篇</h1><div class="post-meta">May 8, 2016<span> | </span><span class="category"><a href="/categories/ReactNative/">ReactNative</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2016/05/08/reactnativezhi-yuan-sheng-mo-kuai-kai-fa-bing-fa-bu-androidpian/" href="/2016/05/08/reactnativezhi-yuan-sheng-mo-kuai-kai-fa-bing-fa-bu-androidpian/#comments" class="ds-thread-count"></a><div class="post-content"><p>前段时间做了个ReactNative的App，发现ReactNative中不少组件并不存在，所以还是需要自己对原生模块进行编写让JS调用，正是因为在这个编写过程中遇到不少问题，发觉了官网文档中许多的不足。所以产生了写一个实践教程的想法，最终有了这么一篇文章。</p>
<p>整篇文章主要以编写一个原生模块为例子，来讲述了我们在编写原生模块所用到的一些知识，并且在整个例子中，配有了完整的实践代码，方便大家理解并调试。除了这些内容，文章还讲述了我们如何将自己编写的原生模块发布到npm上分享给别人使用。希望能够给大家带来帮助，也希望大家将自己编写的原生模块分享出来。</p>
<p>示例代码github地址：<a href="https://github.com/liuchungui/react-native-BGNativeModuleExample" target="_blank" rel="external">https://github.com/liuchungui/react-native-BGNativeModuleExample</a></p>
<a id="more"></a>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>我们需要先创建一个ReactNative工程，使用如下命令创建。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ react native init TestProject</div></pre></td></tr></table></figure>
<p>创建好工程之后，我们使用android studio打开<code>TestProject/android/</code>下的android工程。</p>
<p>之后，点击android studio菜单上的File ——&gt; New ——&gt; New Module，之后选择<code>Android Library</code>，设置模块名和包名，我的设置如下：<br><img src="http://ww2.sinaimg.cn/large/7746cd07jw1f3ilkyhcuzj21kw10w42q.jpg" alt=""></p>
<p>点击完成之后，我们的安卓项目中就多了个名字为<code>nativemoduleexample</code>模块。<br><img src="http://ww1.sinaimg.cn/large/7746cd07jw1f3iluj6owuj20qy11mgt8.jpg" alt=""><br>之后，我们在<code>app</code>工程中的<code>build.gradle</code>文件中的<code>dependencies</code>添加一行<code>compile project(&#39;:nativemoduleexample&#39;)</code>，让主工程<code>app</code>依赖我们新创建的Library。</p>
<p>最后，我们还需要让新创建的Library依赖<code>react native</code>，和上面差不多，只需要在我们新创建的<code>nativemoduleexample</code>下的<code>build.gradle</code>中的<code>dependencies</code>添加一行<code>compile &quot;com.facebook.react:react-native:+&quot;</code>就行了。</p>
<h2 id="一、编写原生模块代码"><a href="#一、编写原生模块代码" class="headerlink" title="一、编写原生模块代码"></a>一、编写原生模块代码</h2><p>####1、创建原生模块，并进行注册<br>我们首先点击打开前面创建的<code>nativemoduleexample</code>库，在<code>src/main/java/com/liuchungui/nativemoduleexample</code>目录下创建我们的原生模块类。当然，如果我们前面创建Library的包名不太一样，那<code>src/main/java/</code>后面跟上就是前面设置的包名。</p>
<p>在这个目录下，我们首先创建一个原生模块<code>BGNativeExampleModule</code>，它继承于<code>ReactContextBaseJavaModule</code>。这个原生模块必须实现两个方法，一个是覆写<code>getName</code>方法，它返回一个字符串名字，在JS中我们就使用这个名字调用这个模块；另外一个是构造方法<code>BGNativeExampleModule</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.liuchungui.nativemoduleexample;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.facebook.react.bridge.NativeModule;</div><div class="line"><span class="keyword">import</span> com.facebook.react.bridge.ReactApplicationContext;</div><div class="line"><span class="keyword">import</span> com.facebook.react.bridge.ReactContext;</div><div class="line"><span class="keyword">import</span> com.facebook.react.bridge.ReactContextBaseJavaModule;</div><div class="line"><span class="keyword">import</span> com.facebook.react.bridge.ReactMethod;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.lang.String;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BGNativeExampleModule</span> <span class="keyword">extends</span> <span class="title">ReactContextBaseJavaModule</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BGNativeExampleModule</span><span class="params">(ReactApplicationContext reactContext)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(reactContext);</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"BGNativeModuleExample"</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中需要注意的是，模块名前的RCT前缀会被自动移除。例如”RCTBGNativeModuleExample”，在JS中的模块名字仍然是BGNativeModuleExample。</p>
<p>到这一步的时候，是不是就可以访问这个模块了？事实是现在还不能访问，因为我们还需要注册这个模块。</p>
<p>为了注册原生模块，我们首先创建一个<code>BGNativeExamplePackage</code>类，这个类要求实现<code>ReactPackage</code>接口，这个接口有三个方法<code>createNativeModules</code>、<code>createJSModules</code>和<code>createViewManagers</code>。其中，<code>createNativeModules</code>是用来添加原生模块的；<code>createViewManagers</code>是用来添加原生的UI组件；<code>createJSModules</code>暂时没用过，但是看官方的注释，应该是注册我们原生模块中用到的JS模块。</p>
<p>我们这里只需要在<code>createNativeModules</code>方法中添加原生模块，其他两个方法返回空数组就行了，整个package类的代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">package com.liuchungui.nativemoduleexample;</div><div class="line"></div><div class="line">import com.facebook.react.ReactPackage;</div><div class="line">import com.facebook.react.bridge.JavaScriptModule;</div><div class="line">import com.facebook.react.bridge.NativeModule;</div><div class="line">import com.facebook.react.bridge.ReactApplicationContext;</div><div class="line">import com.facebook.react.uimanager.ViewManager;</div><div class="line"></div><div class="line">import java.util.Arrays;</div><div class="line">import java.util.Collections;</div><div class="line">import java.util.List;</div><div class="line"></div><div class="line">public class BGNativeExamplePackage implements ReactPackage &#123;</div><div class="line">    @Override</div><div class="line">    public List&lt;NativeModule&gt; createNativeModules(ReactApplicationContext reactContext) &#123;</div><div class="line">        return Arrays.asList(new NativeModule[]&#123;</div><div class="line">                new BGNativeExampleModule(reactContext),</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">    public List&lt;Class&lt;? extends JavaScriptModule&gt;&gt; createJSModules() &#123;</div><div class="line">        return Collections.emptyList();</div><div class="line">    &#125;</div><div class="line">    @Override</div><div class="line">    public List&lt;ViewManager&gt; createViewManagers(ReactApplicationContext reactContext) &#123;</div><div class="line">        return Collections.emptyList();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最后，这个package需要在<code>MainActivity.java</code>文件中的<code>getPackages</code>方法中提供。这个文件位于我们的reactNative应用文件夹的android目录中，路径是:<code>android/app/src/main/java/com/testproject/MainActivity.java</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">protected List&lt;ReactPackage&gt; getPackages() &#123;</div><div class="line">    return Arrays.&lt;ReactPackage&gt;asList(</div><div class="line">        new MainReactPackage(),</div><div class="line">            new BGNativeExamplePackage()</div><div class="line">    );</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>到这个时候，我们终于可以在js中访问我们的原生模块了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">import &#123; NativeModules &#125; from &apos;react-native&apos;;</div><div class="line">var BGNativeModuleExample = NativeModules.BGNativeModuleExample;</div><div class="line">console.log(BGNativeModuleExample);</div></pre></td></tr></table></figure>
<h3 id="2、为原生模块添加方法"><a href="#2、为原生模块添加方法" class="headerlink" title="2、为原生模块添加方法"></a>2、为原生模块添加方法</h3><p>要导出一个方法给JS使用，Java方法需要使用注解<code>@ReactMethod</code>。方法的返回类型必须为void。ReactNative跨语言访问是异步进行的，所以想要给JS返回一个值，唯一的办法是使用回调函数或者发送事件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">import com.facebook.react.bridge.ReactMethod;</div><div class="line"></div><div class="line">@ReactMethod</div><div class="line">public void testPrint(String name, ReadableMap info) &#123;</div><div class="line">	Log.i(TAG, name);</div><div class="line">	Log.i(TAG, info.toString());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在JS中，我们如下调用这个方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">BGNativeModuleExample.testPrint(&quot;Jack&quot;, &#123;</div><div class="line">    height: &apos;1.78m&apos;,</div><div class="line">    weight: &apos;7kg&apos;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h4 id="3、参数类型"><a href="#3、参数类型" class="headerlink" title="3、参数类型"></a>3、参数类型</h4><p>在编写原生模块的时候，我们还需要知道原生Java数据类型和JS数据类型的映射关系：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Boolean -&gt; Bool</div><div class="line">Integer -&gt; Number</div><div class="line">Double -&gt; Number</div><div class="line">Float -&gt; Number</div><div class="line">String -&gt; String</div><div class="line">Callback -&gt; function</div><div class="line">ReadableMap -&gt; Object</div><div class="line">ReadableArray -&gt; Array</div></pre></td></tr></table></figure>
<p>详情参考：<a href="https://github.com/facebook/react-native/blob/master/ReactAndroid/src/main/java/com/facebook/react/bridge/ReadableMap.java" target="_blank" rel="external">ReadableMap</a>和<a href="https://github.com/facebook/react-native/blob/master/ReactAndroid/src/main/java/com/facebook/react/bridge/ReadableArray.java" target="_blank" rel="external">ReadableArray</a></p>
<h3 id="4、回调函数"><a href="#4、回调函数" class="headerlink" title="4、回调函数"></a>4、回调函数</h3><p>原生模块还支持一种特殊的参数——回调函数。它提供了一个函数来把返回值传回给JS。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">import com.facebook.react.bridge.Callback;</div><div class="line"></div><div class="line">@ReactMethod</div><div class="line">public void getNativeClass(Callback callback) &#123;</div><div class="line">      callback.invoke(&quot;BGNativeExampleModule&quot;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在JS中，我们可以通过以下方式获取到原生模块的类名：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">BGNativeModuleExample.getNativeClass(name =&gt; &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"nativeClass: "</span>, name);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="5、Promises"><a href="#5、Promises" class="headerlink" title="5、Promises"></a>5、Promises</h3><blockquote>
<p>原生模块还可以使用promise来简化代码，搭配ES2016(ES7)标准的async/await语法则效果更佳。如果桥接原生方法的最后一个参数是一个Promise，则对应的JS方法就会返回一个Promise对象。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> com.facebook.react.bridge.Promise;</div><div class="line"><span class="meta">@ReactMethod</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPromises</span><span class="params">(Boolean isResolve, Promise promise)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(isResolve) &#123;</div><div class="line">        promise.resolve(isResolve.toString());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        promise.reject(isResolve.toString());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>JS中如下调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">BGNativeModuleExample.testPromises(<span class="literal">true</span>)</div><div class="line">.then(result =&gt; &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"result is "</span>, result);</div><div class="line">&#125;)</div><div class="line">.catch(result =&gt; &#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"result = "</span>, result);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h3 id="6、导出常量"><a href="#6、导出常量" class="headerlink" title="6、导出常量"></a>6、导出常量</h3><p>  我们在<code>getContants</code>方法中导出js所需要使用的常量。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span>  Map&lt;String, Object&gt; <span class="title">getConstants</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">final</span> Map&lt;String, Object&gt; constants = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line">    constants.put(<span class="string">"BGModuleName"</span>, <span class="string">"BGNativeModuleExample"</span>);</div><div class="line">    constants.put(TestEventName, TestEventName);</div><div class="line">    <span class="keyword">return</span> constants;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p> 我们在JS中打印<code>BGModuleName</code>这个常量的值：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">console</span>.log(<span class="string">"BGModuleName const value = "</span>, BGNativeModuleExample.BGModuleName);</div></pre></td></tr></table></figure>
<h3 id="7、给JS发送事件"><a href="#7、给JS发送事件" class="headerlink" title="7、给JS发送事件"></a>7、给JS发送事件</h3><blockquote>
<p>原生模块可以在没有被调用的情况下往JS发送事件通知，最简单的办法是通过<code>RCTDeviceEventEmitter</code>，这可以通过<code>ReactContext</code>获得对应的引用。</p>
</blockquote>
<p>在这里，我们为了能够接收到事件，开启了一个定时器，每一秒发送一次事件：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BGNativeExampleModule</span> <span class="keyword">extends</span> <span class="title">ReactContextBaseJavaModule</span> </span>&#123;</div><div class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = BGNativeExampleModule.class.getSimpleName();</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span>  String TestEventName = <span class="string">"TestEventName"</span>;</div><div class="line">    <span class="keyword">private</span> Timer timer;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BGNativeExampleModule</span><span class="params">(<span class="keyword">final</span> ReactApplicationContext reactContext)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(reactContext);</div><div class="line">        <span class="comment">//开启定时器</span></div><div class="line">        TimerTask task = <span class="keyword">new</span> TimerTask() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                <span class="comment">//发送事件</span></div><div class="line">                WritableMap params = Arguments.createMap();</div><div class="line">                params.putString(<span class="string">"name"</span>, <span class="string">"Jack"</span>);</div><div class="line">                reactContext</div><div class="line">                        .getJSModule(DeviceEventManagerModule.RCTDeviceEventEmitter.class)</div><div class="line">                        .emit(TestEventName, params);</div><div class="line"></div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        timer = <span class="keyword">new</span> Timer();</div><div class="line">        timer.schedule(task, <span class="number">1000</span>, <span class="number">1000</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在JS中，我们这里直接使用<code>DeviceEventEmitter</code>模块来监听事件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//接收事件</span></div><div class="line">DeviceEventEmitter.addListener(BGNativeModuleExample.TestEventName, info =&gt; &#123;</div><div class="line">  <span class="built_in">console</span>.log(info);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>官方文档中，说也可以使用<code>Subscribable mixin</code>的addListenerOn方法来接收事件，其实它就是对<code>DeviceEventEmitter</code>一种封装。而且，在<code>es6</code>之后，不再支持<code>mixins</code>，所以我们直接使用DeviceEventEmitter接收事件比较好。</p>
<h3 id="8、生命周期"><a href="#8、生命周期" class="headerlink" title="8、生命周期"></a>8、生命周期</h3><p>有时候，为了某些目的，我们需要监听ReactNative应用的生命周期。我们可以让原生模块实现<code>LifecycleEventListener</code>接口，然后使用<code>addLifecycleEventListener</code>注册一下监听。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">BGNativeExampleModule</span><span class="params">(<span class="keyword">final</span> ReactApplicationContext reactContext)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>(reactContext);</div><div class="line">    <span class="comment">//添加监听</span></div><div class="line">    reactContext.addLifecycleEventListener(<span class="keyword">this</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>实现<code>LifecycleEventListener</code>接口</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public <span class="keyword">void</span> onHostResume() &#123;</div><div class="line">    Log.i(TAG, <span class="string">"onHostResume"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">@Override</div><div class="line">public <span class="keyword">void</span> onHostPause() &#123;</div><div class="line">    Log.i(TAG, <span class="string">"onHostPause"</span>);</div><div class="line">    timer.cancel();</div><div class="line">&#125;</div><div class="line"></div><div class="line">@Override</div><div class="line">public <span class="keyword">void</span> onHostDestroy() &#123;</div><div class="line">    Log.i(TAG, <span class="string">"onHostDestroy"</span>);</div><div class="line">    timer.cancel();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样，我们就可以监听ReactNative应用的生命周期了。</p>
<p>上面原生代码就编写好了，主要以代码实践为主，弥补官方文档中的一些不足，如果要需要了解更多的原生模块封装的知识，可以参考<a href="http://reactnative.cn/docs/0.22/native-modules-ios.html#content" target="_blank" rel="external">原生模块</a>，也可以参考官方的源代码。</p>
<h2 id="二、发布上线"><a href="#二、发布上线" class="headerlink" title="二、发布上线"></a>二、发布上线</h2><h3 id="建立一个github仓库"><a href="#建立一个github仓库" class="headerlink" title="建立一个github仓库"></a>建立一个github仓库</h3><p>在github上创建一个仓库<code>react-native-BGNativeModuleExample</code>，克隆到本地，并且创建一个<code>android</code>文件夹。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ git <span class="built_in">clone</span> https://github.com/liuchungui/react-native-BGNativeModuleExample.git</div><div class="line">$ <span class="built_in">cd</span> react-native-BGNativeModuleExample</div><div class="line">$ mkdir android</div></pre></td></tr></table></figure>
<h3 id="将Library复制到android文件夹下"><a href="#将Library复制到android文件夹下" class="headerlink" title="将Library复制到android文件夹下"></a>将Library复制到android文件夹下</h3><p>我们首先进入前面创建的<code>nativemoduleexample</code>这个Library下，然后将这个文件目录下所有文件copy到<code>react-native-BGNativeModuleExample/android</code>目录下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ cp -R android/nativemoduleexample/* ~/github/react-native-BGNativeModuleExample/android</div></pre></td></tr></table></figure>
<h3 id="发布到npm"><a href="#发布到npm" class="headerlink" title="发布到npm"></a>发布到npm</h3><p>这里请参考我前面写的<a href="http://www.liuchungui.com/blog/2016/05/02/reactnativezhi-yuan-sheng-mo-kuai-kai-fa-bing-fa-bu-iospian/">ReactNative之原生模块开发并发布——iOS篇</a>中的<code>发布到npm</code>那一节的内容，当然如果你和我一样前面已经发布了<code>1.0.0</code>，只需要将<code>package.json</code>修改一个版本就好了，我这里修改为<code>2.0.0</code>，然后使用下面命令发布。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ npm publish</div><div class="line">+ react-native-nativemodule-example@2.0.0</div></pre></td></tr></table></figure>
<p>这样，我们就成功发布到了<a href="npmjs.org">npmjs.org</a>。</p>
<h2 id="三、添加Example，测试是否可用，添加README"><a href="#三、添加Example，测试是否可用，添加README" class="headerlink" title="三、添加Example，测试是否可用，添加README"></a>三、添加Example，测试是否可用，添加README</h2><p>请点击查看<a href="http://www.liuchungui.com/blog/2016/05/02/reactnativezhi-yuan-sheng-mo-kuai-kai-fa-bing-fa-bu-iospian/">ReactNative之原生模块开发并发布——iOS篇</a>中的<code>添加Example，测试是否可用，添加README</code>这一部分内容，基本上一样的。</p>
<h2 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h2><p><a href="http://blog.csdn.net/dxpqxb/article/details/8659292" target="_blank" rel="external">http://blog.csdn.net/dxpqxb/article/details/8659292</a><br><a href="http://reactnative.cn/docs/0.25/native-modules-android.html#content" target="_blank" rel="external">原生模块</a></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://www.liuchungui.com/2016/05/08/reactnativezhi-yuan-sheng-mo-kuai-kai-fa-bing-fa-bu-androidpian/" data-id="ciula1dyv001gsn9mjrzm6s91" class="article-share-link">分享到</a><div class="tags"><a href="/tags/ReactNative-原生模块-react-native-ReactNative原生模块-react-native-原生模块-react-native-原生模块发布-reactNative原生模块android/">ReactNative, 原生模块, react native, ReactNative原生模块, react native 原生模块, react native 原生模块发布, reactNative原生模块android</a></div><div class="post-nav"><a href="/2016/05/10/mac10-dot-11sheng-ji-an-zhuang-openssl/" class="pre">Mac10.11升级安装openssl</a><a href="/2016/05/02/reactnativezhi-yuan-sheng-mo-kuai-kai-fa-bing-fa-bu-iospian/" class="next">ReactNative之原生模块开发并发布——iOS篇</a></div><div data-thread-key="2016/05/08/reactnativezhi-yuan-sheng-mo-kuai-kai-fa-bing-fa-bu-androidpian/" data-title="ReactNative之原生模块开发并发布——android篇" data-url="http://www.liuchungui.com/2016/05/08/reactnativezhi-yuan-sheng-mo-kuai-kai-fa-bing-fa-bu-androidpian/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2016/05/08/reactnativezhi-yuan-sheng-mo-kuai-kai-fa-bing-fa-bu-androidpian/" data-title="ReactNative之原生模块开发并发布——android篇" data-url="http://www.liuchungui.com/2016/05/08/reactnativezhi-yuan-sheng-mo-kuai-kai-fa-bing-fa-bu-androidpian/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://www.liuchungui.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Gitbook/">Gitbook</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mac/">Mac</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ReactNative/">ReactNative</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/angular/">angular</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/octopress/">octopress</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/年度总结/">年度总结</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/10/22/bootstrap-datetimepicker集成到angular使用/">bootstrap-datetimepicker集成到angular使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/03/angular-入门之常用指令使用/">Angular1.5 入门之常用指令使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/09/搭建Hexo博客/">搭建Hexo博客</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/01/wei-xin-gong-zhong-hao-kai-fa-zong-jie/">微信公众号开发总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/10/mac10-dot-11sheng-ji-an-zhuang-openssl/">Mac10.11升级安装openssl</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/08/reactnativezhi-yuan-sheng-mo-kuai-kai-fa-bing-fa-bu-androidpian/">ReactNative之原生模块开发并发布——android篇</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/05/02/reactnativezhi-yuan-sheng-mo-kuai-kai-fa-bing-fa-bu-iospian/">ReactNative之原生模块开发并发布——iOS篇</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/23/ubuntuxia-da-jian-vpn/">ubuntu下搭建vpn历程</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/04/gcdzong-jie/">GCD总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/04/04/reactnativezhi-flexbu-ju-zong-jie/">ReactNative之Flex布局总结</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">刘春桂的博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'liuchungui'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?40391c9d11f57c2384e5811d517bef62";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>