<div class="highlight"><pre><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">prepareLayout</span><span class="p">{</span>
    <span class="p">[</span><span class="nb">super</span> <span class="n">prepareLayout</span><span class="p">];</span>
    <span class="bp">NSMutableArray</span> <span class="o">*</span><span class="n">layoutInfoArr</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableArray</span> <span class="n">array</span><span class="p">];</span>
    <span class="bp">NSInteger</span> <span class="n">maxNumberOfItems</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="c1">//获取布局信息</span>
    <span class="bp">NSInteger</span> <span class="n">numberOfSections</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">collectionView</span> <span class="n">numberOfSections</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="bp">NSInteger</span> <span class="n">section</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">section</span> <span class="o">&lt;</span> <span class="n">numberOfSections</span><span class="p">;</span> <span class="n">section</span><span class="o">++</span><span class="p">){</span>
        <span class="bp">NSInteger</span> <span class="n">numberOfItems</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">collectionView</span> <span class="nl">numberOfItemsInSection</span><span class="p">:</span><span class="n">section</span><span class="p">];</span>
        <span class="bp">NSMutableArray</span> <span class="o">*</span><span class="n">subArr</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableArray</span> <span class="nl">arrayWithCapacity</span><span class="p">:</span><span class="n">numberOfItems</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="bp">NSInteger</span> <span class="n">item</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">item</span> <span class="o">&lt;</span> <span class="n">numberOfItems</span><span class="p">;</span> <span class="n">item</span><span class="o">++</span><span class="p">){</span>
            <span class="bp">NSIndexPath</span> <span class="o">*</span><span class="n">indexPath</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSIndexPath</span> <span class="nl">indexPathForItem</span><span class="p">:</span><span class="n">item</span> <span class="nl">inSection</span><span class="p">:</span><span class="n">section</span><span class="p">];</span>
            <span class="bp">UICollectionViewLayoutAttributes</span> <span class="o">*</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">self</span> <span class="nl">layoutAttributesForItemAtIndexPath</span><span class="p">:</span><span class="n">indexPath</span><span class="p">];</span>
            <span class="p">[</span><span class="n">subArr</span> <span class="nl">addObject</span><span class="p">:</span><span class="n">attributes</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="n">maxNumberOfItems</span> <span class="o">&lt;</span> <span class="n">numberOfItems</span><span class="p">){</span>
            <span class="n">maxNumberOfItems</span> <span class="o">=</span> <span class="n">numberOfItems</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="c1">//添加到二维数组</span>
        <span class="p">[</span><span class="n">layoutInfoArr</span> <span class="nl">addObject</span><span class="p">:[</span><span class="n">subArr</span> <span class="k">copy</span><span class="p">]];</span>
    <span class="p">}</span>
    <span class="c1">//存储布局信息</span>
    <span class="nb">self</span><span class="p">.</span><span class="n">layoutInfoArr</span> <span class="o">=</span> <span class="p">[</span><span class="n">layoutInfoArr</span> <span class="k">copy</span><span class="p">];</span>
    <span class="c1">//保存内容尺寸</span>
    <span class="nb">self</span><span class="p">.</span><span class="n">contentSize</span> <span class="o">=</span> <span class="n">CGSizeMake</span><span class="p">(</span><span class="n">maxNumberOfItems</span><span class="o">*</span><span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">itemSize</span><span class="p">.</span><span class="n">width</span><span class="o">+</span><span class="nb">self</span><span class="p">.</span><span class="n">interitemSpacing</span><span class="p">)</span><span class="o">+</span><span class="nb">self</span><span class="p">.</span><span class="n">interitemSpacing</span><span class="p">,</span> <span class="n">numberOfSections</span><span class="o">*</span><span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">itemSize</span><span class="p">.</span><span class="n">height</span><span class="o">+</span><span class="nb">self</span><span class="p">.</span><span class="n">lineSpacing</span><span class="p">)</span><span class="o">+</span><span class="nb">self</span><span class="p">.</span><span class="n">lineSpacing</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>